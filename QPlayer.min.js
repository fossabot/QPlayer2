if(!window.QPlayer){window.QPlayer={}}$(function(){$("body").append('<div id="QPlayer"><div id="QPlayer-body"><div id="QPlayer-panel"><div id="QPlayer-cover"><svg id="QPlayer-cover-default" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="32" style="fill:#222"/><circle cx="32" cy="32" r="16"/><circle cx="32" cy="32" r="12" style="fill:#e12"/><circle cx="32" cy="32" r="1.2" style="fill:#fff"/></svg><img id="QPlayer-cover-img" src="" alt="cover"></div><div id="QPlayer-control"><div id="QPlayer-title"><strong id="QPlayer-name"></strong> -<span id="QPlayer-artist"></span></div><div id="QPlayer-progress"><div id="QPlayer-progress-current" style="width: 0;"></div></div><div id="QPlayer-control-bar"><div id="QPlayer-time">00:00</div><div id="QPlayer-control-play"><svg id="QPlayer-btn-previous" xmlns="http://www.w3.org/2000/svg" viewBox="6 6 12 12"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg><svg id="QPlayer-btn-next" xmlns="http://www.w3.org/2000/svg" viewBox="6 6 12 12"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg><div id="QPlayer-btn-play"><svg id="QPlayer-play" xmlns="http://www.w3.org/2000/svg" viewBox="16 10 22 28"><path d="M16 10v28l22-14z"/></svg><svg id="QPlayer-pause" xmlns="http://www.w3.org/2000/svg" viewBox="12 10 24 28"><path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"/></svg></div></div><div id="QPlayer-control-more"><div id="QPlayer-btn-mode"><svg id="QPlayer-btn-repeat" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg><svg id="QPlayer-btn-shuffle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg></div><svg id="QPlayer-btn-list" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M7 10h9V8H7v2zm0-7v2h9V3H7zm0 12h9v-2H7v2zm-4-5h2V8H3v2zm0-7v2h2V3H3zm0 12h2v-2H3v2z"/></svg><svg id="QPlayer-btn-lyrics" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M4 14v2h10v-2H4zm0-8v2h10V6H4zm-2 6h14v-2H2v2zM2 2v2h14V2H2z"/></svg></div></div></div></div><div id="QPlayer-switch"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg></div></div><div id="QPlayer-more"><ol id="QPlayer-list"></ol><div id="QPlayer-lyrics"></div></div><audio id="QPlayer-audio"></audio></div>');var l=window.QPlayer;var o={};var a=$("#QPlayer"),e=$("#QPlayer-audio"),s=$("#QPlayer-cover"),u=$("#QPlayer-cover-img"),f=$("#QPlayer-list"),c=$("#QPlayer-title"),r=$("#QPlayer-more"),t=$("#QPlayer-time"),d=$("#QPlayer-progress"),v=$("#QPlayer-progress-current"),p=$("#QPlayer-lyrics"),i=$("#QPlayer-btn-mode");var h=e[0];var g,y,x,m,n,P;l.version="2.0.0";l.audio=h;l.defaultProvider=l.defaultProvider||"default";l.provider=l.provider||{};l.provider.default=l.provider.default||{dataType:"*",lyrics:function(e,r){var t=e.lrc;if(!t){return}var i=this.dataType;$.ajax({url:t,dataType:i,success:function(e){if(!e){return}r(e)}})}};function w(e){var i=this;if(e===undefined){this.index=-1;this.list=[]}else{this.index=0;this.list=[e]}this.next=function(){if(this.index+1===this.list.length){if(this.list.length>=o.list.length){this.index=0;return i.list[0]}return t()}return this.list[++this.index]};this.previous=function(){if(this.index===0){var e=o.list.length;if(this.list.length===e){this.index=e-1;return this.list[this.index]}var r=n();this.list.unshift(r);return r}if(this.index===-1){return t()}return this.list[--this.index]};function t(){var e=n();i.list.push(e);++i.index;return e}function n(){var e=o.list.length;if(i.index===-1){return s(e)}var r=[];for(var t=0;t<e;++t){if(i.list.includes(t)){continue}r.push(t)}return r[s(r.length)]}function s(e){return Math.floor(Math.random()*e)}}function Q(){if(o.list.length===0){return false}if(l.isShuffle){return l.shuffle.next()}if(++l.index===l.list.length){l.index=0}return l.index}function b(){if(o.list.length===0){return false}if(l.isShuffle){return l.shuffle.previous()}if(--l.index<0){l.index=l.list.length-1}return l.index}function z(){a.addClass("QPlayer-playing");c.marquee("resume")}function C(){if(x){x=false;return}a.removeClass("QPlayer-playing");c.marquee("pause")}function M(e){var r=Math.floor(e/60);e=Math.floor(e%60);if(r<10){r="0"+r}if(e<10){e="0"+e}return r+":"+e}function I(e){return y.eq(e)}function H(s,l){var a=new e;var o;this.call=function(e,r,t){if(!t){t=function(){}}var i=l[e];if(i){r(i);return}var n=s[e];if(n===true){a.set(e,r,t);return}if(n){n(l,r,t);return}t()};this.stop=function(){o=true};this.load=function(){o=false;var e=s.load;if(!e){return}e(l,a)};function e(){var n={};var s={};this.success=function(e,r,t){var i=n[e];if(!i){s[e]={data:r,cache:t};return}i.success(r,t)};this.error=function(e){var r=n[e];if(!r){s[e]=false;return}r.error()};this.set=function(e,r,t){if(o){return}var i=s[e];if(i){r(i.data,i.cache);return}if(i===false){t();return}n[e]={success:r,error:t}}}}function S(e){var r=e.provider||l.defaultProvider;if(typeof r==="string"){var t=l.provider[r];if(!t){console.warn("没有找到相应的 Provider："+r);t={}}t=e.provider=new H(t,e);t.name=r;return t}return r instanceof H?r:new H({},e)}function T(e){this.time=[];this.text=[];this.index=-1;this.nextTime=0;this.offset=0;this.has=false;this.add=function(e,r){var t=this.time.length;for(var i=0;i<t;++i){var n=this.time[i];if(n<e){continue}if(n===e){this.text[i]+="<br>"+r;return}if(i!==t-1){this.time.splice(i,0,e);this.text.splice(i,0,r);return}}this.time[t]=e;this.text[t]=r};this.find=function(e){var r=this.time.length;for(var t=0;t<r;++t){var i=this.time[t]+this.offset;if(i<e){continue}if(i===e){return t}return t-1}return r-1};this.goto=function(e){if(this.index!==-1){$(g[this.index]).removeClass("QPlayer-lyrics-current")}this.nextTime=this.time[e+1]+this.offset;this.index=e;if(e<0){return}var r=$(g[e]).addClass("QPlayer-lyrics-current");p.stop(true).animate({scrollTop:r.offset().top-p.offset().top+p.scrollTop()-(p.height()-r.height())/2})};this.next=function(e){if(isNaN(this.nextTime)||this.nextTime>e){return}this.goto(this.index+1)};this.show=function(){var e=this.text.length;if(e===0){return}var r="";for(var t=0;t<e;++t){r+="<p>"+this.text[t]+"</p>"}p.removeClass("QPlayer-lyrics-no");p.html(r);g=p.children();this.goto(-1)};var r=/^/gm;var t=/\t*\[([0-6]?\d):([0-6]?\d)(?:\.(\d{1,3}))?]/g;var i=/.*/gm;var n=/^\[offset:\t*([+-]?\d+)]/gm;while(r.exec(e)!==null){var s=r.lastIndex;var l;n.lastIndex=s;if((l=n.exec(e))!=null){r.lastIndex=n.lastIndex;this.offset=parseFloat(l[1]);continue}var a=t.lastIndex=s;var o=[];function u(){return(l=t.exec(e))!=null&&l.index===a}if(!u()){++r.lastIndex;continue}do{r.lastIndex=i.lastIndex=t.lastIndex;var f=parseInt(l[1])*6e4+parseInt(l[2])*1e3;var c=l[3];if(c){var d=c.length;f+=parseInt(d<3?c+"0".repeat(3-d):c)}o.push(f);a=t.lastIndex}while(u());if(o.length===0){continue}var v=i.exec(e)[0].trim();var h=o.length;for(var y=0;y<h;++y){this.add(o[y],v)}}this.has=this.time.length!==0}function V(e){if(n===e){P=true;B();l.pause();return true}if(n===-1){n=e}I(e).addClass("QPlayer-list-error");return false}function k(){p.addClass("QPlayer-lyrics-no").html("<p>无歌词，请欣赏。</p>");g=null;v.width("0");h.currentTime=0;s.addClass("QPlayer-cover-no");s.offset();c.marquee("destroy")}function B(){l.index=-1;l.current=null;k();c.html("<strong>没有歌曲</strong>");x=false;n=-1}function q(){var e=0;c.children().each(function(){e+=$(this).width()});return e>c.width()}l.load=function(e){P=false;var t=l.current;if(t){S(t).stop();x=true;h.pause()}k();var r=o.list.length;if(r===0){console.warn("list 为空！");return false}if(!(r>e||e>0)){console.warn("超出 list，length="+r+"，index="+e);return false}f.children(".QPlayer-list-current").removeClass("QPlayer-list-current");var i=I(e).addClass("QPlayer-list-current");if(!t){f.scrollTop(i.offset().top-f.offset().top+1)}t=o.list[e];c.html("<strong>"+t.name+"</strong><span> - "+t.artist+"</span>");if(q()){c.marquee({duration:1e4,gap:40,delayBeforeStart:1e3,duplicated:true,startVisible:true}).marquee("pause")}l.index=e;l.current=t;var n=S(t);n.call("cover",function(e,r){if(P||!e){return}u.attr("src",e);s.removeClass("QPlayer-cover-no");if(r){t.cover=e}});n.call("lyrics",function(e){if(P||!e){return}if(!(e instanceof T)){t.lyrics=new T(e)}t.lyrics.show()});n.load();return true};function L(t,i){m=i;if(t===false){console.warn("list 为空！");return 1}else if(typeof t==="number"){if(!l.load(t)){return V(t)?4:0}}else{t=l.index;if(h.readyState!==0){z();h.play();return 2}}if(t===-1){return 0}z();var n=l.current;function s(){var e=o.list;var r=e[t]===n?t:e.indexOf(n);if(r===-1){console.warn("未找到索引");return}if(V(r)){return}if(i){l.previous()}else{l.next()}}S(n).call("audio",function(e,r){if(P){return}if(!e){s();return}if(r){n.audio=r}h.src=e;h.load();h.play()},s);return 3}l.play=function(e,r){var t=L(e,r);if(t){return t}return r?l.previous():l.next()};l.pause=function(){C();h.pause()};l.next=function(){return l.play(Q())};l.previous=function e(){return l.play(b(),true)};l.setColor=function(r){var e=$("#QPlayer-theme");if(!e.length){e=$('<style id="QPlayer-theme"></style>');a.append(e)}if(!t){e.text("");return}var t=typeof r==="string"?r:r.all;var i;var n="";function s(e){i=r[e];if(i===undefined){i=t}}s("switch");if(i){n+="#QPlayer-switch{background:"+i+";}"}s("progress");if(i){n+="#QPlayer-progress-current{background:"+i+";}"}s("list");if(i){n+="#QPlayer-list li:hover, #QPlayer-list li.QPlayer-list-current{border-left-color:"+i+";}"}s("lyrics");if(i){n+="#QPlayer-lyrics.QPlayer-lyrics-no p,#QPlayer-lyrics p.QPlayer-lyrics-current{color:"+i+";}"}e.text(n)};$("#QPlayer-switch").click(function(){a.toggleClass("QPlayer-show")});$("#QPlayer-btn-list").click(function(){r.toggleClass("QPlayer-list-show")});$("#QPlayer-btn-lyrics").click(function(){r.toggleClass("QPlayer-lyrics-show")});$("#QPlayer-btn-play").click(function(){if(a.hasClass("QPlayer-playing")){l.pause()}else{l.play()}});$("#QPlayer-btn-next").click(l.next);$("#QPlayer-btn-previous").click(l.previous);s.click(function(){l.isRotate=!o.isRotate}).on("error",function(){s.addClass("QPlayer-cover-no")});i.click(function(){l.isShuffle=!o.isShuffle});f.on("click","li:not(.QPlayer-list-current)",function(){var e=$(this).index();if(o.isShuffle){l.shuffle=new w(e)}l.play(e)});e.on("playing",z).on("pause",C).on("ended",l.next).on("timeupdate",function(){var e=h.currentTime;t.text(M(e));var r=l.current.lyrics;if(r&&r.has){r.next(e*1e3)}if(!R){v.width(100*e/h.duration+"%")}}).on("error",function(){console.log("error",arguments);var e=o.list.indexOf(l.current);if(e!==-1&&V(e)){return}if(m){l.previous()}else{l.next()}}).on("canplay",function(){n=-1});var R;function O(e){var r=e.type;switch(r){case"mousedown":case"mouseup":case"mousemove":return e.pageX;case"touchstart":case"touchmove":case"touchend":return e.originalEvent.changedTouches[0].pageX}return false}function j(e){return O(e)-d.offset().left}function A(e){if(!R){return}e.preventDefault();var r=d.width();var t=j(e);v.width(t<r?t:r)}d.on("mousedown touchstart",function(e){R=true;A(e)});$(document).on("mouseup touchend",function(e){if(!R){return}R=false;var r=h.duration;if(isNaN(r)){v.width(0);return}var t=d.width();var i=j(e);if(i>=t){l.next();return}var n=i>0?r*i/t:0;h.currentTime=n;var s=l.current.lyrics;if(s&&s.has){s.goto(s.find(n*1e3))}}).on("mousemove touchmove",A);B();f.html('<li class="QPlayer-list-current">没有歌曲</li>');function N(e){return"QPlayer-"+e}function X(e){var r=localStorage.getItem(N(e));return!!(r&&r!=="false")}function D(e,r){localStorage.setItem(N(e),r)}function E(e){return localStorage.hasOwnProperty(N(e))}function F(e,r){var t=Object.keys(r);var i=t.length;for(var n=0;n<i;++n){var s=t[n];o[s]=e[s]}Object.defineProperties(e,r);for(var l=0;l<i;++l){var a=t[l];if(r[a].type==="bool"&&E(a)){e[a]=X(a);continue}e[a]=o[a]||r[a].default}}F(l,{isShuffle:{get:function(){return o.isShuffle},set:function(e){o.isShuffle=e;D("isShuffle",e);if(e){i.addClass("QPlayer-shuffle");var r=l.index;l.shuffle=new w(r===-1?undefined:r)}else{i.removeClass("QPlayer-shuffle");l.shuffle=null}},type:"bool",default:false},isRotate:{get:function(){return o.isRotate},set:function(e){o.isRotate=e;D("isRotate",e);if(e){s.addClass("QPlayer-cover-rotate")}else{s.removeClass("QPlayer-cover-rotate")}},type:"bool",default:true},list:{get:function(){return o.list},set:function(e){if(!Array.isArray(e)){console.warn("list 应该是数组");return}o.list=e;var r=e.length;var t="";for(var i=0;i<r;++i){var n=e[i];var s=n.artist;if(Array.isArray(s)){n.artist=s=s.join("/")}t+="<li><strong>"+n.name+"</strong><span>"+s+"</span></li>"}l.pause();f.html(t);y=f.children();if(r===0){B();return}if(l.index>-1&&l.current&&r>l.index&&e[l.index]===l.current){return}B();l.load(Q())},type:"list",default:[]}})});