if(!window.QPlayer){window.QPlayer={}}window.QPlayer.init=function(){if(document.getElementById("QPlayer")){return}$("body").append('<div id="QPlayer"><div id="QPlayer-body"><div id="QPlayer-panel"><div id="QPlayer-cover"><svg id="QPlayer-cover-default" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="32" style="fill:#222"/><circle cx="32" cy="32" r="16"/><circle cx="32" cy="32" r="12" style="fill:#e12"/><circle cx="32" cy="32" r="1.2" style="fill:#fff"/></svg></div><div id="QPlayer-control"><div id="QPlayer-title"><strong id="QPlayer-name"></strong> -<span id="QPlayer-artist"></span></div><div id="QPlayer-progress"><div id="QPlayer-progress-current" style="width: 0;"></div></div><div id="QPlayer-control-bar"><div id="QPlayer-time">00:00</div><div id="QPlayer-control-play"><svg id="QPlayer-btn-previous" xmlns="http://www.w3.org/2000/svg" viewBox="6 6 12 12"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg><svg id="QPlayer-btn-next" xmlns="http://www.w3.org/2000/svg" viewBox="6 6 12 12"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg><div id="QPlayer-btn-play"><svg id="QPlayer-play" xmlns="http://www.w3.org/2000/svg" viewBox="16 10 22 28"><path d="M16 10v28l22-14z"/></svg><svg id="QPlayer-pause" xmlns="http://www.w3.org/2000/svg" viewBox="12 10 24 28"><path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"/></svg></div></div><div id="QPlayer-control-more"><div id="QPlayer-btn-mode"><svg id="QPlayer-btn-repeat" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg><svg id="QPlayer-btn-shuffle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg></div><svg id="QPlayer-btn-list" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M7 10h9V8H7v2zm0-7v2h9V3H7zm0 12h9v-2H7v2zm-4-5h2V8H3v2zm0-7v2h2V3H3zm0 12h2v-2H3v2z"/></svg><svg id="QPlayer-btn-lyrics" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M4 14v2h10v-2H4zm0-8v2h10V6H4zm-2 6h14v-2H2v2zM2 2v2h14V2H2z"/></svg></div></div></div></div><div id="QPlayer-switch"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg></div></div><div id="QPlayer-more"><ol id="QPlayer-list"></ol><div id="QPlayer-lyrics"></div></div><audio id="QPlayer-audio"></audio></div>');var a=window.QPlayer;var o={};var l=$("#QPlayer"),e=$("#QPlayer-audio"),t=$("#QPlayer-cover"),u=$("#QPlayer-list"),f=$("#QPlayer-title"),i=$("#QPlayer-more"),n=$("#QPlayer-time"),c=$("#QPlayer-progress"),d=$("#QPlayer-progress-current"),p=$("#QPlayer-lyrics"),s=$("#QPlayer-btn-mode");var v=e[0],r=500;var g,h,y,m,x,w,P;a.version="2.0.6";a.audio=v;a.defaultProvider=a.defaultProvider||"default";a.provider=a.provider||{};a.provider.default=a.provider.default||{dataType:"*",lyrics:function(e,r){var t=e.lrc;if(!t){return}var i=this.dataType;$.ajax({url:t,dataType:i,success:function(e){if(!e){return}r(e)}})}};function Q(e){var i=this;if(e===undefined){this.index=-1;this.list=[]}else{this.index=0;this.list=[e]}this.next=function(){if(this.index+1===this.list.length){if(this.list.length>=o.list.length){this.index=0;return i.list[0]}return t()}return this.list[++this.index]};this.previous=function(){if(this.index===0){var e=o.list.length;if(this.list.length===e){this.index=e-1;return this.list[this.index]}var r=n();this.list.unshift(r);return r}if(this.index===-1){return t()}return this.list[--this.index]};function t(){var e=n();i.list.push(e);++i.index;return e}function n(){var e=o.list.length;if(i.index===-1){return s(e)}var r=[];for(var t=0;t<e;++t){if(i.list.includes(t)){continue}r.push(t)}return r[s(r.length)]}function s(e){return Math.floor(Math.random()*e)}}function b(){if(o.list.length===0){return false}if(a.isShuffle){return a.shuffle.next()}if(++a.index===a.list.length){a.index=0}return a.index}function C(){if(o.list.length===0){return false}if(a.isShuffle){return a.shuffle.previous()}if(--a.index<0){a.index=a.list.length-1}return a.index}function z(){l.addClass("QPlayer-playing");f.marquee("resume")}function T(){if(y){y=false;return}l.removeClass("QPlayer-playing");f.marquee("pause")}function I(e){var r=Math.floor(e/60);e=Math.floor(e%60);if(r<10){r="0"+r}if(e<10){e="0"+e}return r+":"+e}function M(e){return h.eq(e)}function k(s,l){var a=new e;var o;this.call=function(e,r,t){if(!t){t=function(){}}var i=l[e];if(i){r(i);return}var n=s[e];if(n===true){a.set(e,r,t);return}if(n){n(l,r,t);return}t()};this.stop=function(){o=true};this.load=function(){o=false;var e=s.load;if(!e){return}e(l,a)};function e(){var n={};var s={};this.success=function(e,r,t){var i=n[e];if(!i){s[e]={data:r,cache:t};return}i.success(r,t)};this.error=function(e){var r=n[e];if(!r){s[e]=false;return}r.error()};this.set=function(e,r,t){if(o){return}var i=s[e];if(i){r(i.data,i.cache);return}if(i===false){t();return}n[e]={success:r,error:t}}}}function H(e){var r=e.provider||a.defaultProvider;if(typeof r==="string"){var t=a.provider[r];if(!t){console.warn("没有找到相应的 Provider："+r);t={}}t=e.provider=new k(t,e);t.name=r;return t}return r instanceof k?r:new k({},e)}function S(e){this.time=[];this.text=[];this.index=-1;this.nextTime=0;this.offset=0;this.has=false;this.add=function(e,r){var t=this.time.length;for(var i=0;i<t;++i){var n=this.time[i];if(n<e){continue}if(n===e){this.text[i]+="<br>"+r;return}if(i!==t-1){this.time.splice(i,0,e);this.text.splice(i,0,r);return}}this.time[t]=e;this.text[t]=r};this.find=function(e){var r=this.time.length;for(var t=0;t<r;++t){var i=this.time[t]+this.offset;if(i<e){continue}if(i===e){return t}return t-1}return r-1};this.goto=function(e){if(this.index!==-1){$(g[this.index]).removeClass("QPlayer-lyrics-current")}this.nextTime=this.time[e+1]+this.offset;this.index=e;if(e<0){return}var r=$(g[e]).addClass("QPlayer-lyrics-current");p.stop(true).animate({scrollTop:r.offset().top-p.offset().top+p.scrollTop()-(162-r.height())/2})};this.next=function(e){if(isNaN(this.nextTime)||this.nextTime>e){return}this.goto(this.index+1)};this.show=function(){var e=this.text.length;if(e===0){return}var r="";for(var t=0;t<e;++t){r+="<p>"+this.text[t]+"</p>"}p.removeClass("QPlayer-lyrics-no");p.html(r);g=p.children();this.goto(-1)};var r=/^/gm;var t=/\t*\[([0-6]?\d):([0-6]?\d)(?:\.(\d{1,3}))?]/g;var i=/.*/gm;var n=/^\[offset:\t*([+-]?\d+)]/gm;while(r.exec(e)!==null){var s=r.lastIndex;var l;n.lastIndex=s;if((l=n.exec(e))!=null){r.lastIndex=n.lastIndex;this.offset=parseFloat(l[1]);continue}var a=t.lastIndex=s;var o=[];function u(){return(l=t.exec(e))!=null&&l.index===a}if(!u()){++r.lastIndex;continue}do{r.lastIndex=i.lastIndex=t.lastIndex;var f=parseInt(l[1])*6e4+parseInt(l[2])*1e3;var c=l[3];if(c){var d=c.length;f+=parseInt(d<3?c+"0".repeat(3-d):c)}o.push(f);a=t.lastIndex}while(u());if(o.length===0){continue}var v=i.exec(e)[0].trim();var h=o.length;for(var y=0;y<h;++y){this.add(o[y],v)}}this.has=this.time.length!==0}function V(e){if(x===e){w=true;L();a.pause();return true}if(x===-1){x=e}M(e).addClass("QPlayer-list-error");return false}function B(){setTimeout(function(){if(P>=(new Date).getTime()-r){return}t.css("background-image","");t.addClass("QPlayer-cover-no")},r)}function q(){p.addClass("QPlayer-lyrics-no").html("<p>无歌词，请欣赏。</p>");f.html("<strong>没有歌曲</strong>");g=null;d.width("0");v.currentTime=0;B();f.marquee("destroy")}function L(){a.index=-1;a.current=null;q();y=false;x=-1}function R(){L();h=null;u.html('<li class="QPlayer-list-current">没有歌曲</li>')}function A(){var e=0;f.children().each(function(){e+=$(this).width()});return e>f.width()}function O(e){var r=new Image;r.onload=function(){P=(new Date).getTime();t.css("background-image",'url("'+e+'")');t.removeClass("QPlayer-cover-no")};r.src=e}function j(e){u.scrollTop(u.scrollTop()-u.offset().top+e.offset().top+1)}function N(e){return Array.isArray(e)?e.join(" / "):e}a.load=function(e){w=false;var t=a.current;if(t){H(t).stop();y=true;v.pause()}q();var r=o.list.length;if(r===0){console.warn("list 为空！");return false}if(!(r>e||e>0)){console.warn("超出 list，length="+r+"，index="+e);return false}u.children(".QPlayer-list-current").removeClass("QPlayer-list-current");var i=M(e).addClass("QPlayer-list-current");if(!t){j(i)}t=o.list[e];var n="<strong>"+t.name+"</strong>";var s=N(t.artist);if(s){n+="<span> - "+s+"</span>"}f.html(n);if(A()){f.marquee({duration:1e4,gap:40,delayBeforeStart:1e3,duplicated:true,startVisible:true}).marquee("pause")}a.index=e;a.current=t;var l=H(t);l.call("cover",function(e,r){if(w||!e){return}O(e);if(r){t.cover=e}});l.call("lyrics",function(e){if(w||!e){return}if(!(e instanceof S)){t.lyrics=new S(e)}t.lyrics.show()});l.load();return true};function D(r,t){m=t;if(r===false){console.warn("list 为空！");return 1}else if(typeof r==="number"){if(!a.load(r)){return V(r)?4:0}}else{r=a.index;if(v.readyState!==0){z();l();return 2}}if(r===-1){return 0}z();var i=a.current;function n(){var e=o.list;return e[r]===i?r:e.indexOf(i)}function s(){var e=n();if(e===-1){console.warn("未找到索引");return}if(V(e)){return}if(t){a.previous()}else{a.next()}}function l(){function r(e){if(e.name==="AbortError"){return}t=true;console.error([e])}var t=false;var e=null;try{e=v.play();if(typeof Promise==="function"&&e instanceof Promise){e.then(function(){M(n()).removeClass("QPlayer-list-error")}).catch(r)}}catch(e){r(e)}if(!t&&!(typeof Promise==="function"&&e instanceof Promise)){M(n()).removeClass("QPlayer-list-error")}}H(i).call("audio",function(e,r){if(w){return}if(!e){s();return}if(r){i.audio=r}v.src=e;v.load();l()},s);return 3}a.play=function(e,r){var t=D(e,r);if(t){return t}return r?a.previous():a.next()};a.pause=function(){T();v.pause()};a.next=function(){return a.play(b())};a.previous=function(){return a.play(C(),true)};a.reload=function(){a.pause();return a.load(a.index)};a.setColor=function(r){var e=$("#QPlayer-theme");if(!e.length){e=$('<style id="QPlayer-theme"></style>');l.append(e)}var t=typeof r==="string"?r:r.all;if(!t){e.text("");return}var i;var n="";function s(e){i=r[e];if(i===undefined){i=t}}s("switch");if(i){n+="#QPlayer-switch{background:"+i+";}"}s("progress");if(i){n+="#QPlayer-progress-current{background:"+i+";}"}s("list");if(i){n+="#QPlayer-list li:hover, #QPlayer-list li.QPlayer-list-current{border-left-color:"+i+";}"}s("lyrics");if(i){n+="#QPlayer-lyrics.QPlayer-lyrics-no p,#QPlayer-lyrics p.QPlayer-lyrics-current{color:"+i+";}"}e.text(n)};$("#QPlayer-switch").click(function(){l.toggleClass("QPlayer-show")});$("#QPlayer-btn-list").click(function(){var e="QPlayer-list-show";if(i.hasClass(e)){i.removeClass(e)}else{var r=a.index;if(r!==-1){j(M(r))}i.addClass(e)}});$("#QPlayer-btn-lyrics").click(function(){i.toggleClass("QPlayer-lyrics-show")});$("#QPlayer-btn-play").click(function(){if(l.hasClass("QPlayer-playing")){a.pause()}else{a.play()}});$("#QPlayer-btn-next").click(a.next);$("#QPlayer-btn-previous").click(a.previous);t.click(function(){a.isRotate=!o.isRotate});s.click(function(){a.isShuffle=!o.isShuffle});u.on("click","li:not(.QPlayer-list-current)",function(){var e=$(this).index();if(o.isShuffle){a.shuffle=new Q(e)}a.play(e)});e.on("playing",z).on("pause",T).on("ended",a.next).on("timeupdate",function(){var e=v.currentTime;n.text(I(e));var r=a.current.lyrics;if(r&&r.has){r.next(e*1e3)}if(!E){d.width(100*e/v.duration+"%")}}).on("error",function(){console.log("error",arguments);var e=o.list.indexOf(a.current);if(e!==-1&&V(e)){return}if(m){a.previous()}else{a.next()}}).on("canplay",function(){x=-1});var E;function X(e){var r=e.type;switch(r){case"mousedown":case"mouseup":case"mousemove":return e.pageX;case"touchstart":case"touchmove":case"touchend":return e.originalEvent.changedTouches[0].pageX}return false}function F(e){return X(e)-c.offset().left}function G(e){if(!E){return}e.preventDefault();var r=c.width();var t=F(e);d.width(t<r?t:r)}c.on("mousedown touchstart",function(e){E=true;G(e)});$(document).on("mouseup touchend",function(e){if(!E){return}E=false;var r=v.duration;if(isNaN(r)){d.width(0);return}var t=c.width();var i=F(e);if(i>=t){a.next();return}var n=i>0?r*i/t:0;v.currentTime=n;var s=a.current.lyrics;if(s&&s.has){s.goto(s.find(n*1e3))}}).on("mousemove touchmove",G);R();function J(e){return"QPlayer-"+e}function K(e){var r=localStorage.getItem(J(e));return!!(r&&r!=="false")}function U(e,r){localStorage.setItem(J(e),r)}function W(e){return localStorage.hasOwnProperty(J(e))}function Y(e,r){var t=Object.keys(r);var i=t.length;for(var n=0;n<i;++n){var s=t[n];o[s]=e[s]}Object.defineProperties(e,r);for(var l=0;l<i;++l){var a=t[l];if(r[a].type==="bool"&&W(a)){e[a]=K(a);continue}e[a]=o[a]||r[a].default}}Y(a,{isShuffle:{get:function(){return o.isShuffle},set:function(e){o.isShuffle=e;U("isShuffle",e);if(e){s.addClass("QPlayer-shuffle");var r=a.index;a.shuffle=new Q(r===-1?undefined:r)}else{s.removeClass("QPlayer-shuffle");a.shuffle=null}},type:"bool",default:false},isRotate:{get:function(){return o.isRotate},set:function(e){o.isRotate=e;U("isRotate",e);if(e){t.addClass("QPlayer-cover-rotate")}else{t.removeClass("QPlayer-cover-rotate")}},type:"bool",default:true},list:{get:function(){return o.list},set:function(e){if(!Array.isArray(e)){console.warn("list 应该是数组");return}o.list=e;var r=e.length;if(r===0){R();return}var t="";for(var i=0;i<r;++i){var n=e[i];t+="<li><strong>"+n.name+"</strong>";var s=N(n.artist);if(s){t+="<span>"+s+"</span>"}t+="</li>"}a.pause();u.html(t);h=u.children();if(a.index>-1&&a.current&&r>a.index&&e[a.index]===a.current){return}L();a.load(b())},type:"list",default:[]}})};$(window.QPlayer.init);