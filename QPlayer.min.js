if(!window.QPlayer){window.QPlayer={}}window.QPlayer.init=function(){if(document.getElementById("QPlayer")){return}$("body").append('<div id="QPlayer"><div id="QPlayer-body"><div id="QPlayer-panel"><div id="QPlayer-cover"><svg id="QPlayer-cover-default" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="32" style="fill:#222"/><circle cx="32" cy="32" r="16"/><circle cx="32" cy="32" r="12" style="fill:#e12"/><circle cx="32" cy="32" r="1.2" style="fill:#fff"/></svg></div><div id="QPlayer-control"><div id="QPlayer-title"><strong id="QPlayer-name"></strong> -<span id="QPlayer-artist"></span></div><div id="QPlayer-progress"><div id="QPlayer-progress-current" style="width: 0;"></div></div><div id="QPlayer-control-bar"><div id="QPlayer-time">00:00</div><div id="QPlayer-control-play"><svg id="QPlayer-btn-previous" xmlns="http://www.w3.org/2000/svg" viewBox="6 6 12 12"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg><svg id="QPlayer-btn-next" xmlns="http://www.w3.org/2000/svg" viewBox="6 6 12 12"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg><div id="QPlayer-btn-play"><svg id="QPlayer-play" xmlns="http://www.w3.org/2000/svg" viewBox="16 10 22 28"><path d="M16 10v28l22-14z"/></svg><svg id="QPlayer-pause" xmlns="http://www.w3.org/2000/svg" viewBox="12 10 24 28"><path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"/></svg></div></div><div id="QPlayer-control-more"><div id="QPlayer-btn-mode"><svg id="QPlayer-btn-repeat" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg><svg id="QPlayer-btn-shuffle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg></div><svg id="QPlayer-btn-list" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M7 10h9V8H7v2zm0-7v2h9V3H7zm0 12h9v-2H7v2zm-4-5h2V8H3v2zm0-7v2h2V3H3zm0 12h2v-2H3v2z"/></svg><svg id="QPlayer-btn-lyrics" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M4 14v2h10v-2H4zm0-8v2h10V6H4zm-2 6h14v-2H2v2zM2 2v2h14V2H2z"/></svg></div></div></div></div><div id="QPlayer-switch"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg></div></div><div id="QPlayer-more"><ol id="QPlayer-list"></ol><div id="QPlayer-lyrics"></div></div><audio id="QPlayer-audio"></audio></div>');var a=window.QPlayer;var o={};var l=$("#QPlayer"),e=$("#QPlayer-audio"),r=$("#QPlayer-cover"),u=$("#QPlayer-list"),s=$("#QPlayer-title"),t=$("#QPlayer-more"),i=$("#QPlayer-time"),f=$("#QPlayer-progress"),c=$("#QPlayer-progress-current"),p=$("#QPlayer-lyrics"),n=$("#QPlayer-btn-mode");var d=e[0],v=200;var g,h,y,m,w,x,P;a.version="2.0.1";a.audio=d;a.defaultProvider=a.defaultProvider||"default";a.provider=a.provider||{};a.provider.default=a.provider.default||{dataType:"*",lyrics:function(e,t){var r=e.lrc;if(!r){return}var i=this.dataType;$.ajax({url:r,dataType:i,success:function(e){if(!e){return}t(e)}})}};function Q(e){var i=this;if(e===undefined){this.index=-1;this.list=[]}else{this.index=0;this.list=[e]}this.next=function(){if(this.index+1===this.list.length){if(this.list.length>=o.list.length){this.index=0;return i.list[0]}return r()}return this.list[++this.index]};this.previous=function(){if(this.index===0){var e=o.list.length;if(this.list.length===e){this.index=e-1;return this.list[this.index]}var t=n();this.list.unshift(t);return t}if(this.index===-1){return r()}return this.list[--this.index]};function r(){var e=n();i.list.push(e);++i.index;return e}function n(){var e=o.list.length;if(i.index===-1){return s(e)}var t=[];for(var r=0;r<e;++r){if(i.list.includes(r)){continue}t.push(r)}return t[s(t.length)]}function s(e){return Math.floor(Math.random()*e)}}function b(){if(o.list.length===0){return false}if(a.isShuffle){return a.shuffle.next()}if(++a.index===a.list.length){a.index=0}return a.index}function z(){if(o.list.length===0){return false}if(a.isShuffle){return a.shuffle.previous()}if(--a.index<0){a.index=a.list.length-1}return a.index}function C(){l.addClass("QPlayer-playing");s.marquee("resume")}function I(){if(y){y=false;return}l.removeClass("QPlayer-playing");s.marquee("pause")}function T(e){var t=Math.floor(e/60);e=Math.floor(e%60);if(t<10){t="0"+t}if(e<10){e="0"+e}return t+":"+e}function M(e){return h.eq(e)}function k(s,a){var l=new e;var o;this.call=function(e,t,r){if(!r){r=function(){}}var i=a[e];if(i){t(i);return}var n=s[e];if(n===true){l.set(e,t,r);return}if(n){n(a,t,r);return}r()};this.stop=function(){o=true};this.load=function(){o=false;var e=s.load;if(!e){return}e(a,l)};function e(){var n={};var s={};this.success=function(e,t,r){var i=n[e];if(!i){s[e]={data:t,cache:r};return}i.success(t,r)};this.error=function(e){var t=n[e];if(!t){s[e]=false;return}t.error()};this.set=function(e,t,r){if(o){return}var i=s[e];if(i){t(i.data,i.cache);return}if(i===false){r();return}n[e]={success:t,error:r}}}}function H(e){var t=e.provider||a.defaultProvider;if(typeof t==="string"){var r=a.provider[t];if(!r){console.warn("没有找到相应的 Provider："+t);r={}}r=e.provider=new k(r,e);r.name=t;return r}return t instanceof k?t:new k({},e)}function S(e){this.time=[];this.text=[];this.index=-1;this.nextTime=0;this.offset=0;this.has=false;this.add=function(e,t){var r=this.time.length;for(var i=0;i<r;++i){var n=this.time[i];if(n<e){continue}if(n===e){this.text[i]+="<br>"+t;return}if(i!==r-1){this.time.splice(i,0,e);this.text.splice(i,0,t);return}}this.time[r]=e;this.text[r]=t};this.find=function(e){var t=this.time.length;for(var r=0;r<t;++r){var i=this.time[r]+this.offset;if(i<e){continue}if(i===e){return r}return r-1}return t-1};this.goto=function(e){if(this.index!==-1){$(g[this.index]).removeClass("QPlayer-lyrics-current")}this.nextTime=this.time[e+1]+this.offset;this.index=e;if(e<0){return}var t=$(g[e]).addClass("QPlayer-lyrics-current");p.stop(true).animate({scrollTop:t.offset().top-p.offset().top+p.scrollTop()-(p.height()-t.height())/2})};this.next=function(e){if(isNaN(this.nextTime)||this.nextTime>e){return}this.goto(this.index+1)};this.show=function(){var e=this.text.length;if(e===0){return}var t="";for(var r=0;r<e;++r){t+="<p>"+this.text[r]+"</p>"}p.removeClass("QPlayer-lyrics-no");p.html(t);g=p.children();this.goto(-1)};var t=/^/gm;var r=/\t*\[([0-6]?\d):([0-6]?\d)(?:\.(\d{1,3}))?]/g;var i=/.*/gm;var n=/^\[offset:\t*([+-]?\d+)]/gm;while(t.exec(e)!==null){var s=t.lastIndex;var a;n.lastIndex=s;if((a=n.exec(e))!=null){t.lastIndex=n.lastIndex;this.offset=parseFloat(a[1]);continue}var l=r.lastIndex=s;var o=[];function u(){return(a=r.exec(e))!=null&&a.index===l}if(!u()){++t.lastIndex;continue}do{t.lastIndex=i.lastIndex=r.lastIndex;var f=parseInt(a[1])*6e4+parseInt(a[2])*1e3;var c=a[3];if(c){var d=c.length;f+=parseInt(d<3?c+"0".repeat(3-d):c)}o.push(f);l=r.lastIndex}while(u());if(o.length===0){continue}var v=i.exec(e)[0].trim();var h=o.length;for(var y=0;y<h;++y){this.add(o[y],v)}}this.has=this.time.length!==0}function V(e){if(w===e){x=true;L();a.pause();return true}if(w===-1){w=e}M(e).addClass("QPlayer-list-error");return false}function B(){setTimeout(function(){if(P>=(new Date).getTime()-v){return}r.css("background-image","");r.addClass("QPlayer-cover-no")},v)}function q(){p.addClass("QPlayer-lyrics-no").html("<p>无歌词，请欣赏。</p>");g=null;c.width("0");d.currentTime=0;B();s.marquee("destroy")}function L(){a.index=-1;a.current=null;q();s.html("<strong>没有歌曲</strong>");y=false;w=-1}function R(){var e=0;s.children().each(function(){e+=$(this).width()});return e>s.width()}function A(e){var t=new Image;t.onload=function(){P=(new Date).getTime();r.css("background-image",'url("'+e+'")');r.removeClass("QPlayer-cover-no")};t.src=e}a.load=function(e){x=false;var r=a.current;if(r){H(r).stop();y=true;d.pause()}q();var t=o.list.length;if(t===0){console.warn("list 为空！");return false}if(!(t>e||e>0)){console.warn("超出 list，length="+t+"，index="+e);return false}u.children(".QPlayer-list-current").removeClass("QPlayer-list-current");var i=M(e).addClass("QPlayer-list-current");if(!r){u.scrollTop(i.offset().top-u.offset().top+1)}r=o.list[e];s.html("<strong>"+r.name+"</strong><span> - "+r.artist+"</span>");if(R()){s.marquee({duration:1e4,gap:40,delayBeforeStart:1e3,duplicated:true,startVisible:true}).marquee("pause")}a.index=e;a.current=r;var n=H(r);n.call("cover",function(e,t){if(x||!e){return}A(e);if(t){r.cover=e}});n.call("lyrics",function(e){if(x||!e){return}if(!(e instanceof S)){r.lyrics=new S(e)}r.lyrics.show()});n.load();return true};function O(r,i){m=i;if(r===false){console.warn("list 为空！");return 1}else if(typeof r==="number"){if(!a.load(r)){return V(r)?4:0}}else{r=a.index;if(d.readyState!==0){C();d.play();return 2}}if(r===-1){return 0}C();var n=a.current;function s(){var e=o.list;var t=e[r]===n?r:e.indexOf(n);if(t===-1){console.warn("未找到索引");return}if(V(t)){return}if(i){a.previous()}else{a.next()}}H(n).call("audio",function(e,t){if(x){return}if(!e){s();return}if(t){n.audio=t}d.src=e;d.load();function r(e){if(e.name==="AbortError"){return}throw e}try{var i=d.play();if(typeof Promise==="function"&&i instanceof Promise){i.catch(r)}}catch(e){r(e)}},s);return 3}a.play=function(e,t){var r=O(e,t);if(r){return r}return t?a.previous():a.next()};a.pause=function(){I();d.pause()};a.next=function(){return a.play(b())};a.previous=function e(){return a.play(z(),true)};a.setColor=function(t){var e=$("#QPlayer-theme");if(!e.length){e=$('<style id="QPlayer-theme"></style>');l.append(e)}if(!r){e.text("");return}var r=typeof t==="string"?t:t.all;var i;var n="";function s(e){i=t[e];if(i===undefined){i=r}}s("switch");if(i){n+="#QPlayer-switch{background:"+i+";}"}s("progress");if(i){n+="#QPlayer-progress-current{background:"+i+";}"}s("list");if(i){n+="#QPlayer-list li:hover, #QPlayer-list li.QPlayer-list-current{border-left-color:"+i+";}"}s("lyrics");if(i){n+="#QPlayer-lyrics.QPlayer-lyrics-no p,#QPlayer-lyrics p.QPlayer-lyrics-current{color:"+i+";}"}e.text(n)};$("#QPlayer-switch").click(function(){l.toggleClass("QPlayer-show")});$("#QPlayer-btn-list").click(function(){t.toggleClass("QPlayer-list-show")});$("#QPlayer-btn-lyrics").click(function(){t.toggleClass("QPlayer-lyrics-show")});$("#QPlayer-btn-play").click(function(){if(l.hasClass("QPlayer-playing")){a.pause()}else{a.play()}});$("#QPlayer-btn-next").click(a.next);$("#QPlayer-btn-previous").click(a.previous);r.click(function(){a.isRotate=!o.isRotate});n.click(function(){a.isShuffle=!o.isShuffle});u.on("click","li:not(.QPlayer-list-current)",function(){var e=$(this).index();if(o.isShuffle){a.shuffle=new Q(e)}a.play(e)});e.on("playing",C).on("pause",I).on("ended",a.next).on("timeupdate",function(){var e=d.currentTime;i.text(T(e));var t=a.current.lyrics;if(t&&t.has){t.next(e*1e3)}if(!j){c.width(100*e/d.duration+"%")}}).on("error",function(){console.log("error",arguments);var e=o.list.indexOf(a.current);if(e!==-1&&V(e)){return}if(m){a.previous()}else{a.next()}}).on("canplay",function(){w=-1});var j;function N(e){var t=e.type;switch(t){case"mousedown":case"mouseup":case"mousemove":return e.pageX;case"touchstart":case"touchmove":case"touchend":return e.originalEvent.changedTouches[0].pageX}return false}function D(e){return N(e)-f.offset().left}function E(e){if(!j){return}e.preventDefault();var t=f.width();var r=D(e);c.width(r<t?r:t)}f.on("mousedown touchstart",function(e){j=true;E(e)});$(document).on("mouseup touchend",function(e){if(!j){return}j=false;var t=d.duration;if(isNaN(t)){c.width(0);return}var r=f.width();var i=D(e);if(i>=r){a.next();return}var n=i>0?t*i/r:0;d.currentTime=n;var s=a.current.lyrics;if(s&&s.has){s.goto(s.find(n*1e3))}}).on("mousemove touchmove",E);L();u.html('<li class="QPlayer-list-current">没有歌曲</li>');function X(e){return"QPlayer-"+e}function F(e){var t=localStorage.getItem(X(e));return!!(t&&t!=="false")}function G(e,t){localStorage.setItem(X(e),t)}function J(e){return localStorage.hasOwnProperty(X(e))}function K(e,t){var r=Object.keys(t);var i=r.length;for(var n=0;n<i;++n){var s=r[n];o[s]=e[s]}Object.defineProperties(e,t);for(var a=0;a<i;++a){var l=r[a];if(t[l].type==="bool"&&J(l)){e[l]=F(l);continue}e[l]=o[l]||t[l].default}}K(a,{isShuffle:{get:function(){return o.isShuffle},set:function(e){o.isShuffle=e;G("isShuffle",e);if(e){n.addClass("QPlayer-shuffle");var t=a.index;a.shuffle=new Q(t===-1?undefined:t)}else{n.removeClass("QPlayer-shuffle");a.shuffle=null}},type:"bool",default:false},isRotate:{get:function(){return o.isRotate},set:function(e){o.isRotate=e;G("isRotate",e);if(e){r.addClass("QPlayer-cover-rotate")}else{r.removeClass("QPlayer-cover-rotate")}},type:"bool",default:true},list:{get:function(){return o.list},set:function(e){if(!Array.isArray(e)){console.warn("list 应该是数组");return}o.list=e;var t=e.length;var r="";for(var i=0;i<t;++i){var n=e[i];var s=n.artist;if(Array.isArray(s)){n.artist=s=s.join("/")}r+="<li><strong>"+n.name+"</strong><span>"+s+"</span></li>"}a.pause();u.html(r);h=u.children();if(t===0){L();return}if(a.index>-1&&a.current&&t>a.index&&e[a.index]===a.current){return}L();a.load(b())},type:"list",default:[]}})};$(window.QPlayer.init);